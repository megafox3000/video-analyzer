<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–Ω–∞–ª–∏–∑ –í–∏–¥–µ–æ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2em;
      background-color: #f9f9f9;
    }
    h1 {
      color: #333;
    }
    input[type="file"] {
      margin-bottom: 1em;
    }
    button {
      padding: 0.5em 1em;
      font-size: 16px;
    }
    pre {
      background-color: #eee;
      padding: 1em;
      overflow-x: auto;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <h1>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –∏ –∞–Ω–∞–ª–∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö</h1>

  <input type="file" id="videoFile" accept="video/*" />
  <br>
  <button onclick="analyzeVideo()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>

  <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
  <div id="result"></div>

  <script>
    async function analyzeVideo() {
      const fileInput = document.getElementById('videoFile');
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞...';

      const file = fileInput.files[0];
      if (!file) {
        resultDiv.innerHTML = '<p class="error">‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –≤–∏–¥–µ–æ—Ñ–∞–π–ª.</p>';
        return;
      }

      const formData = new FormData();
      formData.append('file', file);

      try {
        const response = await fetch('https://video-meta-api.onrender.com/analyze', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          const error = await response.text();
          resultDiv.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞: ${response.status}<br>${error}</p>`;
          return;
        }

        const data = await response.json();
        resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;

        // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—ã
        if (data.gps && data.gps.length > 0) {
          data.gps.forEach(g => {
            const link = document.createElement('a');
            link.href = g.link;
            link.target = '_blank';
            link.textContent = `üìç –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ (${g.lat}, ${g.lon})`;
            resultDiv.appendChild(document.createElement('br'));
            resultDiv.appendChild(link);
          });
        }

      } catch (err) {
        resultDiv.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${err}</p>`;
      }
    }
  </script>
</body>
</html>
